#!/usr/bin/env bash

wal-tile() {
  wal -n -i "$@"
  killall swaybg
  swaybg -m fill -i "$(< "${HOME}/.cache/wal/wal")" &
}

wpg-tile() {
  wpg -s "$@"
  killall swaybg
  swaybg -m fill -i "$(< "${HOME}/.cache/wal/wal")" &
}

walls_dir="$HOME/Pictures/bg"
cd $walls_dir
wall=$(ls $walls_dir | shuf -n 1 | xargs realpath)

# wal-tile $wall
# wpg -ns $wall
wpg-tile $wall

file-line-change() {
  arg1=$(realpath "$1") # file name
  arg2=$2 # string in a line that will be replaced
  arg3=$3 # string that will replace the line
  
# Get the line containing "@import"
old_line=$(grep $arg2 $arg1)

# Check if the old line exists in the file
if [ -n "$old_line" ]; then
    # Replace the line using sed
    # wal_filename=$(realpath $HOME/.cache/wal/colors-waybar.css)
    new_line=$arg3
    sed -i "s|$old_line|$new_line|" "$arg1"
    echo "Line replaced successfully in $arg1"
else
    echo "Old line not found in the file."
fi
}

# waybar
file-line-change "$HOME/.config/waybar/style.css" "@import" "@import url('$(realpath $HOME/.cache/wal/colors-waybar.css)');"

# qutebrowser 
file-line-change "$HOME/.config/qutebrowser/start/styles.css" "@import" "@import url('$(realpath $HOME/.cache/wal/colors.css)');"

# zathura
file-line-change "$HOME/.config/zathura/zathurarc" "include" "include $(realpath $HOME/.cache/wal/colors-zathurarc)"

$HOME/.config/scripts/hypr/waybar-start.sh
# $HOME/.config/mako/update-theme.sh
$HOME/.config/swaync/reload.sh
emacsclient --eval '(load-theme real-theme t)'

notify-send "New rice applied"
